"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6019],{15680:(e,n,t)=>{t.d(n,{xA:()=>c,yg:()=>d});var a=t(96540);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function l(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},s=Object.keys(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(a=0;a<s.length;a++)t=s[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var u=a.createContext({}),p=function(e){var n=a.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):l(l({},n),e)),t},c=function(e){var n=p(e.components);return a.createElement(u.Provider,{value:n},e.children)},i="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},g=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,s=e.originalType,u=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),i=p(t),g=r,d=i["".concat(u,".").concat(g)]||i[g]||m[g]||s;return t?a.createElement(d,l(l({ref:n},c),{},{components:t})):a.createElement(d,l({ref:n},c))}));function d(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var s=t.length,l=new Array(s);l[0]=g;var o={};for(var u in n)hasOwnProperty.call(n,u)&&(o[u]=n[u]);o.originalType=e,o[i]="string"==typeof e?e:r,l[1]=o;for(var p=2;p<s;p++)l[p]=t[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,t)}g.displayName="MDXCreateElement"},8605:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>u,contentTitle:()=>l,default:()=>m,frontMatter:()=>s,metadata:()=>o,toc:()=>p});var a=t(58168),r=(t(96540),t(15680));const s={},l="OpenGauss",o={unversionedId:"study/db/SQL/OpenGauss",id:"study/db/SQL/OpenGauss",title:"OpenGauss",description:"\u5b98\u7f51 https://opengauss.org/zh/",source:"@site/docs/study/db/SQL/OpenGauss.md",sourceDirName:"study/db/SQL",slug:"/study/db/SQL/OpenGauss",permalink:"/docs/study/db/SQL/OpenGauss",draft:!1,tags:[],version:"current",lastUpdatedAt:1732679924,formattedLastUpdatedAt:"2024\u5e7411\u670827\u65e5",frontMatter:{},sidebar:"studySidebar",previous:{title:"MySQL",permalink:"/docs/study/db/SQL/MySQL"},next:{title:"PostgreSQL",permalink:"/docs/study/db/SQL/PostgreSQL"}},u={},p=[{value:"\u5e38\u7528\u7684\u5de5\u5177",id:"\u5e38\u7528\u7684\u5de5\u5177",level:3},{value:"\u5982\u4f55\u67e5\u770b\u7248\u672c",id:"\u5982\u4f55\u67e5\u770b\u7248\u672c",level:3},{value:"\u5982\u4f55\u67e5\u770b\u6700\u5927\u8fde\u63a5\u6570",id:"\u5982\u4f55\u67e5\u770b\u6700\u5927\u8fde\u63a5\u6570",level:3},{value:"\u5982\u4f55\u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570",id:"\u5982\u4f55\u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570",level:3},{value:"\u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570\u62a5\u9519",id:"\u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570\u62a5\u9519",level:3}],c={toc:p},i="wrapper";function m(e){let{components:n,...t}=e;return(0,r.yg)(i,(0,a.A)({},c,t,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("h1",{id:"opengauss"},"OpenGauss"),(0,r.yg)("p",null,"\u5b98\u7f51 ",(0,r.yg)("a",{parentName:"p",href:"https://opengauss.org/zh/"},"https://opengauss.org/zh/")),(0,r.yg)("p",null,"\u5bf9\u6807\u7684\u662fPostgreSQL"),(0,r.yg)("h3",{id:"\u5e38\u7528\u7684\u5de5\u5177"},"\u5e38\u7528\u7684\u5de5\u5177"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"gsql \u8fd9\u662f OpenGauss \u6570\u636e\u5e93\u7684\u4ea4\u4e92\u5f0f\u5ba2\u6237\u7aef\u5de5\u5177\uff0c\u7528\u4e8e\u8fde\u63a5\u6570\u636e\u5e93\u5e76\u6267\u884c SQL \u547d\u4ee4\u3002\\q\uff08\u5728 gsql \u4e2d\u4f7f\u7528\uff09\uff1a\u7528\u4e8e\u9000\u51fagsql\u4ea4\u4e92\u5f0f\u5ba2\u6237\u7aef\u3002"),(0,r.yg)("li",{parentName:"ul"},"gs_dump \u7528\u4e8e\u5907\u4efd\u6570\u636e\u5e93\u3002"),(0,r.yg)("li",{parentName:"ul"},"gs_dumpall\uff1a\u7528\u4e8e\u5907\u4efd\u6574\u4e2a\u6570\u636e\u5e93\u7cfb\u7edf\uff0c\u5305\u62ec\u6240\u6709\u6570\u636e\u5e93\u548c\u7528\u6237\u4fe1\u606f\u7b49\u3002"),(0,r.yg)("li",{parentName:"ul"},"gs_restore\uff1a\u7528\u4e8e\u6062\u590d\u6570\u636e\u5e93\u5907\u4efd\u3002"),(0,r.yg)("li",{parentName:"ul"},"gs_om\u662f OpenGauss \u6570\u636e\u5e93\u63d0\u4f9b\u7684\u4e00\u4e2a\u91cd\u8981\u7684\u8fd0\u7ef4\u7ba1\u7406\u5de5\u5177\u3002\u5b83\u4e3b\u8981\u7528\u4e8e\u6570\u636e\u5e93",(0,r.yg)("strong",{parentName:"li"},"\u96c6\u7fa4"),"\u7684\u5b89\u88c5\u3001\u542f\u52a8\u3001\u505c\u6b62\u3001\u72b6\u6001\u67e5\u770b\u4ee5\u53ca\u914d\u7f6e\u7ba1\u7406\u7b49\u64cd\u4f5c\uff0c\u5e2e\u52a9\u7ba1\u7406\u5458\u9ad8\u6548\u5730\u7ef4\u62a4 OpenGauss \u6570\u636e\u5e93\u73af\u5883\u3002",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"gs_om --help \u4e0d\u540c\u7248\u672c\uff0c\u53ef\u80fd\u53c2\u6570\u4e0d\u4e00\u6837\uff0c\u4f7f\u7528\u6b64\u547d\u4ee4\u5177\u4f53\u67e5\u770b"),(0,r.yg)("li",{parentName:"ul"},"gs_om -t start \u5b83\u4f1a\u6309\u7167\u9884\u5148\u914d\u7f6e\u7684\u65b9\u5f0f\u542f\u52a8\u6574\u4e2a OpenGauss \u6570\u636e\u5e93\u96c6\u7fa4\u3002\u5728\u542f\u52a8\u8fc7\u7a0b\u4e2d\uff0cgs_om\u4f1a\u68c0\u67e5\u96c6\u7fa4\u8282\u70b9\u7684\u72b6\u6001\uff0c\u4f9d\u6b21\u542f\u52a8\u5404\u4e2a\u8282\u70b9\u4e0a\u7684\u6570\u636e\u5e93\u670d\u52a1\u3002"),(0,r.yg)("li",{parentName:"ul"},"gs_om -t stop \u505c\u6b62\u96c6\u7fa4"),(0,r.yg)("li",{parentName:"ul"},"gs_om -t status \u67e5\u770b\u96c6\u7fa4\u72b6\u6001"),(0,r.yg)("li",{parentName:"ul"},"gs_om -t refreshconf \u91cd\u65b0\u52a0\u8f7d\u96c6\u7fa4\u914d\u7f6e"))),(0,r.yg)("li",{parentName:"ul"},"gs_ctl gs_ctl\u662f OpenGauss \u6570\u636e\u5e93\u4e2d\u7684\u4e00\u4e2a\u91cd\u8981\u7684\u63a7\u5236\u5de5\u5177\u3002\u5b83\u4e3b\u8981\u7528\u4e8e\u5bf9",(0,r.yg)("strong",{parentName:"li"},"\u5355\u4e2a\u6570\u636e\u5e93\u8282\u70b9"),"\u8fdb\u884c\u7ba1\u7406\u548c\u63a7\u5236\uff0c\u5305\u62ec\u542f\u52a8\u3001\u505c\u6b62\u3001\u91cd\u542f\u6570\u636e\u5e93\u5b9e\u4f8b\uff0c\u4ee5\u53ca\u68c0\u67e5\u6570\u636e\u5e93\u72b6\u6001\u3001\u6545\u969c\u6062\u590d\u7b49\u64cd\u4f5c\u3002",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"gs_ctl --help \u4e0d\u540c\u7248\u672c\uff0c\u53ef\u80fd\u53c2\u6570\u4e0d\u4e00\u6837\uff0c\u4f7f\u7528\u6b64\u547d\u4ee4\u5177\u4f53\u67e5\u770b"),(0,r.yg)("li",{parentName:"ul"},"gs_ctl start -D DATADIR \u542f\u52a8"),(0,r.yg)("li",{parentName:"ul"},"gs_ctl stop -D DATADIR \u505c\u6b62"),(0,r.yg)("li",{parentName:"ul"},"gs_ctl restart -D DATADIR \u91cd\u542f"),(0,r.yg)("li",{parentName:"ul"},"gs_ctl status -D DATADIR \u72b6\u6001\u68c0\u67e5"),(0,r.yg)("li",{parentName:"ul"},"gs_ctl reload -D DATADIR \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\u6587\u4ef6\uff0c\u800c\u65e0\u9700\u91cd\u542f"),(0,r.yg)("li",{parentName:"ul"},"cat postgresql.conf|grep -v '^\\s*#'|grep -v \"^$\"  \u67e5\u770b\u914d\u7f6e\u6587\u4ef6\u53bb\u6389\u6ce8\u91ca\u884c"))),(0,r.yg)("li",{parentName:"ul"},"\u7269\u7406\u5907\u4efd gs_basebackup"),(0,r.yg)("li",{parentName:"ul"},"\u903b\u8f91\u5907\u4efd gs_dump gs_dumpall\uff0c\u6ca1\u6709\u589e\u91cf\u5907\u4efd")),(0,r.yg)("h3",{id:"\u5982\u4f55\u67e5\u770b\u7248\u672c"},"\u5982\u4f55\u67e5\u770b\u7248\u672c"),(0,r.yg)("p",null,"\u6267\u884cSQL\uff0cselect version();"),(0,r.yg)("h3",{id:"\u5982\u4f55\u67e5\u770b\u6700\u5927\u8fde\u63a5\u6570"},"\u5982\u4f55\u67e5\u770b\u6700\u5927\u8fde\u63a5\u6570"),(0,r.yg)("p",null,"\u6267\u884cSQL\uff0cSELECT * FROM pg_settings WHERE name = 'max_connections';"),(0,r.yg)("h3",{id:"\u5982\u4f55\u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570"},"\u5982\u4f55\u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570"),(0,r.yg)("p",null,"\u4fee\u6539postgresql.conf\u6587\u4ef6\u7684max_connections\u53c2\u6570"),(0,r.yg)("p",null,"\u4e0d\u4e00\u5b9a\u4f1a\u6210\u529f\uff0c\u9700\u8981\u67e5\u770b\u65e5\u5fd7\u6216\u8005\u518d\u67e5\u8be2\u4e00\u904d\u770b\u770b\u6548\u679c"),(0,r.yg)("h3",{id:"\u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570\u62a5\u9519"},"\u4fee\u6539\u6700\u5927\u8fde\u63a5\u6570\u62a5\u9519"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"2024-05-14 10:02:06.004 [unknown] [unknown] localhost 140450292528512 0[0:0#0]  0 [CACHE] LOG:  set data cache  size(402653184)\n2024-05-14 10:02:06.247 [unknown] [unknown] localhost 140450292528512 0[0:0#0]  0 [BACKEND] FATAL:  could not create semaphores: No space left on device\n2024-05-14 10:02:06.247 [unknown] [unknown] localhost 140450292528512 0[0:0#0]  0 [BACKEND] DETAIL:  Failed system call was semget(5432129, 17, 03600).\n2024-05-14 10:02:06.247 [unknown] [unknown] localhost 140450292528512 0[0:0#0]  0 [BACKEND] HINT:  This error does *not* mean that you have run out of disk space.  It occurs when either the system limit for the maximum number of semaphore sets (SEMMNI), or the system wide maximum number of semaphores (SEMMNS), would be exceeded.  You need to raise the respective kernel parameter.  Alternatively, reduce openGauss's consumption of semaphores by reducing its max_connections parameter.\n        The openGauss documentation contains more information about configuring your system for openGauss.\n2024-05-14 10:02:06.247 [unknown] [unknown] localhost 140450292528512 0[0:0#0]  0 [BACKEND] BACKTRACELOG:  tid[1]'s backtrace:\n        gaussdb(+0xe3a41e) [0x55c87d3c041e]\n        gaussdb(_Z9errfinishiz+0x441) [0x55c87d3b8651]\n        gaussdb(+0xbb6618) [0x55c87d13c618]\n        gaussdb(_Z17PGSemaphoreCreateP15PGSemaphoreData+0x9c) [0x55c87d13c93c]\n        gaussdb(_Z14InitProcGlobalv+0x7dd) [0x55c87e18bddd]\n        gaussdb(_Z31CreateSharedMemoryAndSemaphoresbi+0x3a5) [0x55c87e165605]\n        gaussdb(_Z14PostmasterMainiPPc+0x183f) [0x55c87d982a4f]\n        gaussdb(main+0x3f2) [0x55c87ce545f2]\n        /usr/lib64/libc.so.6(+0x2d210) [0x7fbd21d16210]\n        /usr/lib64/libc.so.6(__libc_start_main+0x7c) [0x7fbd21d162bc]\n        gaussdb(_start+0x25) [0x55c87cec57f5]\n        Use addr2line to get pretty function name and line\n\n2024-05-14 10:02:06.342 [unknown] [unknown] localhost 140450292528512 0[0:0#0]  0 [BACKEND] LOG:  FiniNuma allocIndex: 0.\n")),(0,r.yg)("p",null,"\u4e0a\u9762\u7684\u62a5\u9519\u662f\u56e0\u4e3a\u5bbf\u4e3b\u673a\u7684\u4fe1\u53f7\u91cf\u8bbe\u7f6e\u7684\u592a\u5c0f\u4e86"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"# \u5728\u5bbf\u4e3b\u673a\u6267\u884c \u67e5\u770b\u4fe1\u53f7\u91cf\u76f8\u5173\u8bbe\u7f6e\nsysctl -a|grep sem\nipcs -ls\ncat  /proc/sys/kernel/sem\n# \u7ed3\u679c\u5982\u4e0b\n------ Semaphore Limits --------\nmax number of arrays = 128\nmax semaphores per array = 250\nmax semaphores system wide = 32000\nmax ops per semop call = 32\nsemaphore max value = 32767\n")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-shell"},"#\u4fee\u6539 vi /etc/sysctl.conf \u7684\u4ee5\u4e0b\u53c2\u6570\nkernel.sem = 50100 128256000 50100 2560\n#\nsysctl -p \u751f\u6548\n#\u91cd\u542f\u6570\u636e\u5e93\u5373\u53ef\n")))}m.isMDXComponent=!0}}]);